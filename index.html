<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Market Shop ‚Äî Drinks & Foods</title>
  <meta name="description" content="Market shop demo with profile, cart, Telegram checkout, order history and export" />
  <style>
    :root{ --bg:#0b1220; --card:#0f1724; --muted:#9aa4b2; --accent:#ff7a59; --accent-2:#7c3aed; --glass: rgba(255,255,255,0.03); --glass-2: rgba(255,255,255,0.02); }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#071022 0%, #081428 60%);color:#e6eef8}
    .wrap{max-width:1150px;margin:22px auto;display:grid;grid-template-columns:1fr 400px;gap:18px;padding:16px}
    header{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;padding:14px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    header h1{margin:0;font-size:18px}
    .panel{background:linear-gradient(180deg,var(--card),#0c1626);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .controls{display:flex;gap:8px;align-items:center}
    .search{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:8px 12px;border-radius:999px;background:var(--glass-2);cursor:pointer;font-size:14px}
    .chip.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;display:flex;flex-direction:column;gap:8px}
    .img{height:140px;border-radius:10px;background-size:cover;background-position:center}
    .title{font-weight:700}
    .price{font-weight:700}
    .muted{color:var(--muted);font-size:13px}
    .btn{padding:8px 10px;border-radius:10px;border:none;background:var(--accent);color:white;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
    .cart{position:sticky;top:22px}
    .cart-item{display:flex;justify-content:space-between;gap:8px;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.03)}
    .small{font-size:13px;color:var(--muted)}
    input[type=number]{width:72px;padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .empty{padding:18px;border-radius:10px;background:rgba(255,255,255,0.02);text-align:center;color:var(--muted)}
    footer{grid-column:1/-1;text-align:center;color:var(--muted);margin-top:12px}
    /* modal */
    .modal{position:fixed;inset:0;display:grid;place-items:center;background:rgba(2,6,23,0.6);z-index:60}
    .modal-card{width:96%;max-width:720px;background:#0b1220;border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
    .field{display:flex;flex-direction:column;margin-bottom:10px}
    .field label{font-size:13px;color:var(--muted);margin-bottom:6px}
    .input{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .history-list{max-height:380px;overflow:auto;margin-top:12px}
    .history-item{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px}
    
    /* Member card styles */
    .member-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
        margin-top: 16px;
    }
    .member-card {
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
        padding: 16px;
        border-radius: 12px;
        text-align: center;
        border: 1px solid rgba(255,255,255,0.03);
    }
    .member-photo {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin: 0 auto 12px;
        background-size: cover;
        background-position: center;
        border: 3px solid var(--accent);
    }
    .member-name {
        font-weight: 700;
        margin-bottom: 4px;
    }
    .member-position {
        color: var(--accent);
        font-size: 14px;
        margin-bottom: 8px;
    }
    .member-bio {
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 12px;
        line-height: 1.4;
    }
    .social-btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: rgba(59, 89, 152, 0.2);
        color: #e6eef8;
        text-decoration: none;
        border-radius: 6px;
        font-size: 13px;
        transition: all 0.3s ease;
    }
    .social-btn:hover {
        background: rgba(59, 89, 152, 0.4);
        transform: translateY(-1px);
    }
    
    @media (max-width:980px){ .wrap{grid-template-columns:1fr;padding:12px} .cart{position:relative;top:auto} .search{width:200px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>GARDEN OF EAT'N ‚Äî WHERE FLAVORS GROW</h1>
        <div class="small">Foods ‚Üí Lunch / Snacks / Dessert</div>
      </div>
      <div class="controls">
        <input id="search" class="search" placeholder="Search products or categories..." />
        <button id="openProfileBtn" class="btn btn-ghost">Profile</button>
        <button id="openHistoryBtn" class="btn btn-ghost">üìú Order History</button>
        <button id="openMembersBtn" class="btn btn-ghost">üë• Our Team</button>
      </div>
    </header>

    <main>
      <div class="panel">
        <div style="display:flex;align-items:center;gap:10px;justify-content:space-between">
          <div class="chips" id="categoryChips"></div>
          <div style="display:flex;gap:8px;align-items:center">
            <div class="small">Filter foods:</div>
            <select id="foodFilter" class="chip" style="padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
              <option value="all">All</option>
              <option value="Lunch">Lunch</option>
              <option value="Snacks">Snacks</option>
              <option value="Dessert">Dessert</option>
            </select>
          </div>
        </div>

        <div id="productGrid" class="grid"></div>
      </div>

      <div style="height:12px"></div>

      <div class="panel">
        <h3 style="margin:0">Product Details</h3>
        <div id="detailArea" style="margin-top:12px">Select a product to see details.</div>
      </div>
    </main>

    <aside class="panel cart">
      <h3 style="margin:0">Cart</h3>
      <div id="cartList" style="margin-top:12px"></div>
      <div id="cartSummary" style="margin-top:12px"></div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button id="checkoutBtn" class="btn">Checkout & Send to Telegram</button>
        <button id="clearCartBtn" class="btn btn-ghost">Clear</button>
      </div>
      <div style="margin-top:10px" class="small">Orders are sent to Telegram bot & saved locally.</div>
    </aside>

    <footer>Build in Telegram Databasis and Commands ‚Äî hosted at GitHub Pages. Data persists locally in your browser.</footer>
  </div>

  <!-- Profile modal -->
  <div id="profileModal" class="modal" style="display:none">
    <div class="modal-card">
      <h2 style="margin:0 0 10px 0">Your Profile (one-time edit)</h2>
      <div class="field"><label>Last name</label><input id="last" class="input" /></div>
      <div class="field"><label>First name</label><input id="first" class="input" /></div>
      <div class="field"><label>Middle name</label><input id="middle" class="input" /></div>
      <div class="field"><label>Grade level</label><select id="grade" class="input"></select></div>
      <div class="field"><label>Section</label><select id="section" class="input"></select></div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="saveProfileBtn" class="btn">Save</button>
        <button id="closeProfileBtn" class="btn btn-ghost">Close</button>
      </div>
      <div class="small" style="margin-top:10px">Note: Profile can be <strong>edited only once</strong>. After one edit it will be locked.</div>
    </div>
  </div>

  <!-- History modal -->
  <div id="historyModal" class="modal" style="display:none">
    <div class="modal-card">
      <h2 style="margin:0 0 10px 0">Order History</h2>
      <div class="history-list" id="historyList"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="exportBtn" class="btn">‚¨áÔ∏è Export History</button>
        <button id="clearHistoryBtn" class="btn btn-ghost">üóëÔ∏è Clear History</button>
        <button id="closeHistoryBtn" class="btn btn-ghost">Close</button>
      </div>
    </div>
  </div>

  <!-- Membership modal -->
  <div id="membersModal" class="modal" style="display:none">
    <div class="modal-card">
      <h2 style="margin:0 0 10px 0">üë• Our Team</h2>
      <div class="small" style="margin-bottom: 16px">Meet the people behind Garden of Eat'n</div>
      
      <div class="member-grid" id="memberList">
        <!-- Team members will be populated here -->
      </div>
      
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:20px">
        <button id="closeMembersBtn" class="btn btn-ghost">Close</button>
      </div>
    </div>
  </div>

  <script>
    // ---------- CONFIG (USER) ----------
    const TELEGRAM_TOKEN = '8401966943:AAGPOrgidI0FUMLhJ5gFRyFecwK3x3u-_1E';
    const TELEGRAM_CHAT_ID = '6064653643';
    const SHOP_BASE = 'https://renz2451.github.io/MARKET-SHOP-BY-RENZ/';
    // ------------------------------------

    // products
    const PRODUCTS = [
      { id:'waffle-solo', category:'foods', sub:'Snacks', title:'Waffle Solo', price:30, img:'https://images.unsplash.com/photo-1601992964700-2f8d7d0a6a5c?auto=format&fit=crop&w=800&q=60', desc:'Crispy waffle.' },
      { id:'iced-coffee', category:'drinks', title:'Iced Coffee', price:60, img:'https://images.unsplash.com/photo-1511920170033-f8396924c348?auto=format&fit=crop&w=800&q=60', desc:'Cold brewed coffee.' },
      { id:'chicken-rice', category:'foods', sub:'Lunch', title:'Chicken Rice', price:120, img:'https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/logo.jpeg', desc:'Grilled chicken with rice.' },
      { id:'french-fries', category:'foods', sub:'Snacks', title:'French Fries', price:80, img:'https://images.unsplash.com/photo-1544025162-d76694265947?auto=format&fit=crop&w=800&q=60', desc:'Crispy fries.' },
      { id:'chocolate-cake', category:'foods', sub:'Dessert', title:'Chocolate Cake', price:110, img:'https://images.unsplash.com/photo-1601992964700-2f8d7d0a6a5c?auto=format&fit=crop&w=800&q=60', desc:'Rich chocolate cake.' },
      { id:'ice-cream-scoop', category:'foods', sub:'Dessert', title:'Ice Cream Scoop', price:65, img:'https://images.unsplash.com/photo-1528825871115-3581a5387919?auto=format&fit=crop&w=800&q=60', desc:'Creamy vanilla ice cream.' },
      { id:'mango-shake', category:'drinks', title:'Mango Shake', price:70, img:'https://images.unsplash.com/photo-1561043433-aaf687c4cf4b?auto=format&fit=crop&w=800&q=60', desc:'Creamy mango blended shake.' },
      { id:'mineral-water', category:'drinks', title:'Mineral Water', price:25, img:'https://images.unsplash.com/photo-1505575967450-1b5f7d1f0cdf?auto=format&fit=crop&w=800&q=60', desc:'Refreshing bottled water.' }
    ];

    // Team members data
    const TEAM_MEMBERS = [
      {
        id: 1,
        name: "Sarah Maerel Domingo",
        position: "Executive manager",
        bio: "An executive manager is a high-level leader in a company, responsible for making major decisions, setting strategic goals, and leading the organization toward success. They have a broad scope of authority, allowing them to direct many aspects of the business, including operations, finances, and personnel.",
        photo: "https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/sarah.jpeg",
        facebook: "https://facebook.com/renz.lozada"
      },
      {
        id: 2,
        name: "Jemimah Ashley Garcia",
        position: "Finance Manager",
        bio: "‚ÄéA Finance Manager is responsible for overseeing and managing a company or department's financial activities and strategy. This role typically involves managing budgets, conducting financial forecasting, and facilitating the efficient use of resources to achieve business goals.",
        photo: "https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/jemimah.jpeg",
        facebook: "https://facebook.com/maria.santos"
      },
      {
        id: 3,
        name: "Jea Mae Castro",
        position: "Operational Manager",
        bio: "Operational Manager is a key role focused on the efficiency and effectiveness of an organization's daily operations. They oversee a wide range of activities, ensuring smooth workflows, resource optimization, and the achievement of strategic goals..",
        photo: "https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/jea.jpeg",
        facebook: "https://facebook.com/juan.delacruz"
      },
      {
        id: 4,
        name: "Kian Yepes",
        position: "Head Chef",
        bio: "Leads the service team, coordinates tasks among crew members, and ensures smooth customer service operations. They also help train new crew and maintain service standards.",
        photo: "https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/kian.jpeg",
        facebook: "https://facebook.com/sophia.rodriguez"
      },
      {
        id: 5,
        name: "Marinelle Tinaripe",
        position: "Chef 1",
        bio: "Assist the head chef in preparing dishes, managing ingredients, and maintaining food quality. They may take charge of specific sections in the kitchen and ensure that food is prepared efficiently and on time.",
        photo: "https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/marinelle.jpeg",
        facebook: "https://facebook.com/sophia.rodriguez"
      },
      {
        id: 6,
        name: "Danniel Ogayon",
        position: "Chef 2",
        bio: "Assist the head chef in preparing dishes, managing ingredients, and maintaining food quality. They may take charge of specific sections in the kitchen and ensure that food is prepared efficiently and on time.",
        photo: "https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/daniel.jpeg",
        facebook: "https://facebook.com/sophia.rodriguez"
      },
      {
        id: 7,
        name: "Hayden Angelo",
        position: "Head Crew",
        bio: "‚ÄéA head crew member, often called a crew leader or crew chief, is responsible for leading and overseeing a team of workers to ensure tasks are completed safely, efficiently, and to a high standard. They are the primary point of contact for their crew and are involved in various aspects of team management, including task delegation, scheduling, safety compliance, and training.",
        photo: "https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/hayden.jpeg",
        facebook: "https://facebook.com/sophia.rodriguez"
      },
      {
        id: 8,
        name: "Marcky Rhain Custodio",
        position: "Crew 1",
        bio: "Provide direct support in daily operations, including serving customers, maintaining cleanliness, assisting in food preparation, and performing other assigned tasks under the supervision of the head crew.",
        photo: "https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/marcky.jpeg",
        facebook: "https://facebook.com/sophia.rodriguez"
      },
      {
        id: 9,
        name: "Terence Simbre",
        position: "Crew 2",
        bio: "Provide direct support in daily operations, including serving customers, maintaining cleanliness, assisting in food preparation, and performing other assigned tasks under the supervision of the head crew.",
        photo: "https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/terence.jpeg",
        facebook: "https://facebook.com/sophia.rodriguez"
      },
      {
        id: 10,
        name: "Evrick Vicente",
        position: "Client Relations",
        bio: "Responsible for maintaining positive relationships with clients or customers. This role focuses on addressing inquiries, resolving concerns, managing accounts, and ensuring overall client satisfaction to encourage loyalty and repeat business.",
        photo: "https://raw.githubusercontent.com/renz2451/MARKET-SHOP-BY-RENZ/refs/heads/main/Products/Logo/evrick.jpeg",
        facebook: "https://facebook.com/sophia.rodriguez"
      }
    ];

    // storage keys
    const LS_CART = 'market_cart_v2';
    const LS_PROFILE = 'market_profile_v2';
    const LS_PROFILE_EDITS = 'market_profile_edits_v2';
    const LS_ORDERS = 'market_orders_v2';
    const LS_ORDER_SEQ = 'market_order_seq_v2';

    // state
    let cart = JSON.parse(localStorage.getItem(LS_CART) || '[]');
    let profile = JSON.parse(localStorage.getItem(LS_PROFILE) || 'null');
    let profileEdits = Number(localStorage.getItem(LS_PROFILE_EDITS) || 0);
    let orders = JSON.parse(localStorage.getItem(LS_ORDERS) || '[]');
    let orderSeq = JSON.parse(localStorage.getItem(LS_ORDER_SEQ) || '{}');
    let activeCategory = 'all';

    // dom refs
    const grid = document.getElementById('productGrid');
    const categoryChips = document.getElementById('categoryChips');
    const foodFilter = document.getElementById('foodFilter');
    const checkoutBtn = document.getElementById('checkoutBtn');
    const searchInput = document.getElementById('search');
    const cartList = document.getElementById('cartList');
    const cartSummary = document.getElementById('cartSummary');
    const detailArea = document.getElementById('detailArea');
    const profileModal = document.getElementById('profileModal');
    const historyModal = document.getElementById('historyModal');
    const membersModal = document.getElementById('membersModal');
    
    // ---------- Populate grade & section dropdowns ----------
    const gradeSelect = document.getElementById('grade');
    const sectionSelect = document.getElementById('section');

    // Grades 7 to 12
    for (let g = 7; g <= 12; g++) {
        let opt = document.createElement('option');
        opt.value = g;
        opt.textContent = 'Grade ' + g;
        gradeSelect.appendChild(opt);
    }

    // Sections A to F
    ['A','B','C','D','E','F'].forEach(s => {
        let opt = document.createElement('option');
        opt.value = s;
        opt.textContent = s;
        sectionSelect.appendChild(opt);
    });

    // ---------- MISSING FUNCTIONS ----------
    
    // This function was referenced but not defined
    function cancelOrder(orderId) {
    if (!confirm('Are you sure you want to cancel this order?')) return;
    
    const order = orders.find(o => o.id === orderId);
    if (order) {
        order.status = 'CANCEL';
        order.cancelReason = 'Cancelled by user';
        localStorage.setItem(LS_ORDERS, JSON.stringify(orders));
        
        // Send Telegram notification about cancellation
        sendCancellationNotice(order);
        
        renderHistory();
        alert('Order cancelled');
    }
}

function sendCancellationNotice(order) {
    const name = `${order.profile.last}, ${order.profile.first}${order.profile.middle ? ' ' + order.profile.middle : ''}`;
    const time = formatPHDate(new Date());
    
    let message = `‚ùå ORDER CANCELLED\n`;
    message += `üìã Order ID: ${order.id}\n`;
    message += `üë§ Customer: ${name}\n`;
    message += `üéì Grade/Section: ${order.profile.grade} - ${order.profile.section}\n`;
    message += `üïí Cancellation Time: ${time} (GMT+8)\n`;
    message += `üì¶ Items (${order.items.length}):\n`;
    
    order.items.forEach(it => {
        message += `- ${it.title} x${it.qty} = ‚Ç±${(it.price * it.qty).toFixed(2)}\n`;
    });
    
    message += `üí∞ Original Total: ‚Ç±${order.total.toFixed(2)}\n`;
    message += `üî∞ Reason: Cancelled by customer via website`;
    
    // Send to Telegram
    sendTelegramMessage(message);
}

function sendAdminCancellationNotice(order, reason) {
    const name = `${order.profile.last}, ${order.profile.first}${order.profile.middle ? ' ' + order.profile.middle : ''}`;
    const time = formatPHDate(new Date());
    
    let message = `üö´ ADMIN CANCELLATION\n`;
    message += `üìã Order ID: ${order.id}\n`;
    message += `üë§ Customer: ${name}\n`;
    message += `üéì Grade/Section: ${order.profile.grade} - ${order.profile.section}\n`;
    message += `üïí Cancellation Time: ${time} (GMT+8)\n`;
    message += `üì¶ Items (${order.items.length}):\n`;
    
    order.items.forEach(it => {
        message += `- ${it.title} x${it.qty} = ‚Ç±${(it.price * it.qty).toFixed(2)}\n`;
    });
    
    message += `üí∞ Original Total: ‚Ç±${order.total.toFixed(2)}\n`;
    message += `üìù Reason: ${reason || 'No reason provided'}\n`;
    message += `üë®‚Äçüíº Action: Cancelled by admin via Telegram`;
    
    sendTelegramMessage(message);
}

    // This function was referenced but not properly defined
    function renderCancelButtons() {
        // This is handled in the renderHistory function now
    }

    // ---------- UI renderers ----------
    function renderChips() { 
        const cats = ['all','drinks','foods']; 
        categoryChips.innerHTML = ''; 
        cats.forEach(c => { 
            const el = document.createElement('div'); 
            el.className = 'chip' + (c === activeCategory ? ' active' : ''); 
            el.textContent = c === 'all' ? 'All' : (c === 'foods' ? 'Foods' : capitalize(c)); 
            el.addEventListener('click', () => { 
                activeCategory = c; 
                document.querySelectorAll('.chip').forEach(x => x.classList.remove('active')); 
                el.classList.add('active'); 
                renderProducts(); 
            }); 
            categoryChips.appendChild(el); 
        }); 
    }
    
    function capitalize(s) { 
        return s.charAt(0).toUpperCase() + s.slice(1); 
    }

    function renderProducts() { 
        const q = (searchInput.value || '').toLowerCase().trim(); 
        const foodSel = foodFilter.value; 
        grid.innerHTML = ''; 
        const filtered = PRODUCTS.filter(p => {
            if (activeCategory !== 'all') { 
                if (activeCategory === 'drinks' && p.category !== 'drinks') return false; 
                if (activeCategory === 'foods' && p.category !== 'foods') return false; 
            }
            if (p.category === 'foods' && foodSel !== 'all' && p.sub !== foodSel) return false; 
            const hay = (p.title + ' ' + (p.desc || '') + ' ' + (p.sub || '') + ' ' + p.category).toLowerCase(); 
            if (q && !hay.includes(q)) return false; 
            return true; 
        });
        
        if (filtered.length === 0) { 
            grid.innerHTML = '<div class="empty">No products found</div>'; 
            return; 
        }
        
        filtered.forEach(p => { 
            const card = document.createElement('div'); 
            card.className = 'card'; 
            
            const img = document.createElement('div'); 
            img.className = 'img'; 
            img.style.backgroundImage = `url(${p.img})`; 
            img.id = 'prod-' + p.id; 
            
            const title = document.createElement('div'); 
            title.className = 'title'; 
            title.textContent = p.title; 
            
            const meta = document.createElement('div'); 
            meta.className = 'muted'; 
            meta.textContent = `${p.category}${p.sub ? ' ‚Ä¢ ' + p.sub : ''}`; 
            
            const bottom = document.createElement('div'); 
            bottom.style.display = 'flex'; 
            bottom.style.justifyContent = 'space-between'; 
            bottom.style.alignItems = 'center'; 
            
            const price = document.createElement('div'); 
            price.className = 'price'; 
            price.textContent = '‚Ç±' + Number(p.price).toFixed(2); 
            
            const add = document.createElement('button'); 
            add.className = 'btn'; 
            add.textContent = 'Add'; 
            add.addEventListener('click', (ev) => { 
                ev.stopPropagation(); 
                addToCart(p.id); 
            }); 
            
            bottom.appendChild(price); 
            bottom.appendChild(add); 
            card.appendChild(img); 
            card.appendChild(title); 
            card.appendChild(meta); 
            card.appendChild(bottom); 
            card.addEventListener('click', () => showDetail(p.id)); 
            grid.appendChild(card); 
        }); 
    }

    function showDetail(id) { 
        const p = PRODUCTS.find(x => x.id === id); 
        if (!p) return; 
        detailArea.innerHTML = `
            <div style="display:flex;gap:12px;align-items:flex-start">
                <div style="width:180px;height:120px;border-radius:10px;background-image:url('${p.img}');background-size:cover;background-position:center"></div>
                <div>
                    <div style="font-weight:800;font-size:16px">${p.title}</div>
                    <div class="small">${p.category}${p.sub ? ' ‚Ä¢ ' + p.sub : ''}</div>
                    <div style="margin-top:8px">${p.desc || ''}</div>
                    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
                        <div style="font-weight:800">‚Ç±${Number(p.price).toFixed(2)}</div>
                        <button class="btn" onclick="addToCart('${p.id}')">Add to cart</button>
                    </div>
                </div>
            </div>
        `; 
    }

    // ---------- CART ----------
    function addToCart(id) { 
        const p = PRODUCTS.find(x => x.id === id); 
        if (!p) return; 
        const ex = cart.find(c => c.id === id); 
        if (ex) { 
            ex.qty += 1; 
        } else { 
            cart.push({ id: p.id, title: p.title, price: Number(p.price), qty: 1, img: p.img }); 
        } 
        saveCart(); 
        renderCart(); 
    }
    
    function saveCart() { 
        localStorage.setItem(LS_CART, JSON.stringify(cart)); 
    }
    
    function renderCart() { 
        cartList.innerHTML = ''; 
        if (cart.length === 0) { 
            cartList.innerHTML = '<div class="empty">Cart is empty</div>'; 
            cartSummary.innerHTML = ''; 
            return; 
        } 
        
        let total = 0; 
        cart.forEach((it, idx) => { 
            const row = document.createElement('div'); 
            row.className = 'cart-item'; 
            
            const left = document.createElement('div'); 
            left.style.flex = '1'; 
            left.innerHTML = `<div style="font-weight:700">${it.title}</div><div class="small">‚Ç±${Number(it.price).toFixed(2)} each</div>`; 
            
            const right = document.createElement('div'); 
            right.style.minWidth = '140px'; 
            right.style.display = 'flex'; 
            right.style.alignItems = 'center'; 
            right.style.justifyContent = 'flex-end'; 
            
            const qty = document.createElement('input'); 
            qty.type = 'number'; 
            qty.value = it.qty; 
            qty.min = 1; 
            qty.addEventListener('change', (e) => { 
                it.qty = Math.max(1, Number(e.target.value) || 1); 
                saveCart(); 
                renderCart(); 
            }); 
            
            const del = document.createElement('button'); 
            del.className = 'btn btn-ghost'; 
            del.textContent = 'Remove'; 
            del.style.marginLeft = '8px'; 
            del.addEventListener('click', () => { 
                cart.splice(idx, 1); 
                saveCart(); 
                renderCart(); 
            }); 
            
            right.appendChild(qty); 
            right.appendChild(del); 
            row.appendChild(left); 
            row.appendChild(right); 
            cartList.appendChild(row); 
            total += it.price * it.qty; 
        }); 
        
        cartSummary.innerHTML = `
            <div style="display:flex;justify-content:space-between">
                <div class="small">Items: ${cart.length}</div>
                <div style="font-weight:800">Total: ‚Ç±${total.toFixed(2)}</div>
            </div>
        `; 
    }

    // ---------- PROFILE ----------
    function openProfileModal() { 
        profileModal.style.display = 'grid'; 
        fillProfileInputs(); 
        updateProfileInputs(); 
    }
    
    function closeProfileModal() { 
        profileModal.style.display = 'none'; 
    }
    
    function fillProfileInputs() { 
        if (!profile) return; 
        document.getElementById('last').value = profile.last || ''; 
        document.getElementById('first').value = profile.first || ''; 
        document.getElementById('middle').value = profile.middle || ''; 
        if (profile.grade) gradeSelect.value = profile.grade; 
        if (profile.section) sectionSelect.value = profile.section; 
    }
    
    function updateProfileInputs() { 
        const locked = profile && profile.locked && profileEdits >= 1; 
        document.getElementById('last').disabled = locked; 
        document.getElementById('first').disabled = locked; 
        document.getElementById('middle').disabled = locked; 
        document.getElementById('grade').disabled = locked; 
        document.getElementById('section').disabled = locked; 
        document.getElementById('saveProfileBtn').disabled = locked; 
    }
    
    function saveProfile() { 
        const last = document.getElementById('last').value.trim(); 
        const first = document.getElementById('first').value.trim(); 
        const middle = document.getElementById('middle').value.trim(); 
        const grade = document.getElementById('grade').value.trim(); 
        const sectionVal = document.getElementById('section').value.trim().toUpperCase(); 
        
        if (!last || !first || !grade || !sectionVal) { 
            alert('Please fill Last, First, Grade, and Section'); 
            return; 
        }
        
        const isNew = !profile; 
        if (isNew) { 
            profileEdits = 0; 
        }
        
        if (profile && profile.locked && profileEdits >= 1) { 
            alert('Profile already locked after one edit.'); 
            closeProfileModal(); 
            return; 
        }
        
        profile = { 
            last, 
            first, 
            middle, 
            grade, 
            section: sectionVal, 
            locked: profile ? profile.locked : false, 
            formatted: `${last}, ${first}${middle ? ' ' + middle : ''}` 
        };
        
        if (!isNew) { 
            profileEdits = (profileEdits || 0) + 1; 
            if (profileEdits >= 1) profile.locked = true; 
        }
        
        localStorage.setItem(LS_PROFILE, JSON.stringify(profile)); 
        localStorage.setItem(LS_PROFILE_EDITS, String(profileEdits)); 
        updateProfileDisplay(); 
        updateProfileInputs(); 
        closeProfileModal(); 
        alert('Profile saved. You can edit only once.'); 
    }

    function updateProfileDisplay() { 
        const btn = document.getElementById('openProfileBtn'); 
        if (profile) { 
            btn.textContent = `${profile.formatted} ‚Ä¢ ${profile.grade} - ${profile.section}`; 
        } else { 
            btn.textContent = 'Set profile'; 
        } 
    }

    // ---------- TELEGRAM HANDLING ----------
    async function checkTelegramUpdates() {
        try {
            const res = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/getUpdates`);
            const data = await res.json();
            if (!data.ok) return;
            
            for (const update of data.result) {
                if (update.message && update.message.text) {
                    handleTelegramMessage(update.message);
                }
            }
        } catch (error) {
            console.warn('Telegram updates check failed:', error);
        }
    }

    async function checkTelegramUpdates() {
        try {
            const res = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/getUpdates`);
            const data = await res.json();
            if (!data.ok) return;
            
            for (const update of data.result) {
                if (update.message && update.message.text) {
                    handleTelegramMessage(update.message);
                }
            }
        } catch (error) {
            console.warn('Telegram updates check failed:', error);
        }
    }

  function handleTelegramMessage(msg) {
    const text = msg.text.toUpperCase().trim();

    // Updated regex to match new order ID format: ORD-<initials>-<sequence>-<timestamp>
    const orderIds = Array.from(text.matchAll(/ORD-[A-Z]{2}-\d+-\d+/g)).map(m => m[0]);

    if (text.startsWith('STATUS - ')) {
        const parts = text.split(' ');
        const code = parts[2]; // C, D, R, CANCEL
        const reasonMatch = text.match(/REASON\s*:\s*(.*)/i);
        const reason = reasonMatch ? reasonMatch[1] : '';

        const updatedOrders = [];

        orderIds.forEach(orderId => {
            const ord = orders.find(o => o.id === orderId);
            if (ord) {
                if (ord.status === 'CANCEL' && code !== 'CANCEL') return;

                if (!ord._statusNotified) ord._statusNotified = {};

                if (!ord._statusNotified[code]) {
                    ord.status = code;
                    if (code === 'CANCEL') ord.cancelReason = reason || 'No reason';
                    ord._statusNotified[code] = true;
                    updatedOrders.push(ord);
                } else {
                    ord.status = code;
                    if (code === 'CANCEL') ord.cancelReason = reason || 'No reason';
                }
            }
        });

        if (updatedOrders.length > 0) {
            localStorage.setItem(LS_ORDERS, JSON.stringify(orders));

            const orderList = updatedOrders.map(o => o.id).join(', ');
            if (code === 'CANCEL') {
                sendTelegramMessage(`‚ö†Ô∏è Orders cancelled: ${orderList}\nReason: ${reason || 'No reason provided'}`);
            } else {
                sendTelegramMessage(`‚ö†Ô∏è Orders status updated to ${statusText(code)}: ${orderList}`);
            }
        }
    }
    else if (text.includes('PAID') || text.includes('UNPAID')) {
        const payStatus = text.includes('PAID') ? 'PAID' : 'UNPAID';
        const updatedOrders = [];

        orderIds.forEach(orderId => {
            const ord = orders.find(o => o.id === orderId);
            if (ord) {
                if (!ord._paymentNotified || ord.payment !== payStatus) {
                    ord.payment = payStatus;
                    ord._paymentNotified = true;
                    updatedOrders.push(ord);
                } else {
                    ord.payment = payStatus;
                }
            }
        });

        if (updatedOrders.length > 0) {
            localStorage.setItem(LS_ORDERS, JSON.stringify(orders));
            const orderList = updatedOrders.map(o => o.id).join(', ');
            sendTelegramMessage(`üí∞ Payment status updated to ${payStatus} for: ${orderList}`);
        }
    }

    renderHistory();
}


function statusText(code) {
    switch (code) {
        case 'C': return 'COOKING';
        case 'D': return 'DELIVERING';
        case 'R': return 'DELIVERED';
        case 'CANCEL': return 'CANCELLED';
        default: return code;
    }
}

    async function sendTelegramMessage(text) {
        try {
            await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text, parse_mode: 'HTML' })
            });
        } catch (error) {
            console.warn('Failed to send Telegram message:', error);
        }
    }

    // Polling every 10 sec
    setInterval(checkTelegramUpdates, 10000);

    async function sendOrderToTelegram(order) {
    const name = `${order.profile.last}, ${order.profile.first}${order.profile.middle ? ' ' + order.profile.middle : ''}`;
    const time = formatPHDate(new Date(order.timestampISO));
    
    let message = `üõí Order ID: ${order.id}\n`;
    message += `üõí Order from: ${name}\n`;
    message += `üéì Grade/Section: ${order.profile.grade} - ${order.profile.section}\n`;
    message += `üïí Date/Time: ${time} (GMT+8)\n\n`;
    message += `üì¶ Items:\n`;
    
    order.items.forEach(it => {
        message += `- ${it.title} x${it.qty} = ‚Ç±${(it.price * it.qty).toFixed(2)}\n`;
    });
    
    message += `\nüí∞ Total: ‚Ç±${order.total.toFixed(2)}\n\n`;
    message += `üîó <a href="${SHOP_BASE}">GARDEN OF EAT'N</a>`;

    // Send all product images first
    if (order.items && order.items.length > 0) {
        for (let i = 0; i < order.items.length; i++) {
            const item = order.items[i];
            try {
                const caption = i === 0 ? 
                    `üõí New Order: ${order.id}\nüë§ ${name} ‚Ä¢ ${order.profile.grade}-${order.profile.section}` :
                    `${item.title} x${item.qty}`;
                
                await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`, {
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        chat_id: TELEGRAM_CHAT_ID, 
                        photo: item.img, 
                        caption: caption,
                        parse_mode: 'HTML'
                    })
                });
                
                // Small delay between images to avoid rate limiting
                if (i < order.items.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            } catch (e) { 
                console.warn(`Failed to send image for ${item.title}`, e);
                // Continue with next image
            }
        }
        
        // Then send the detailed summary message
        await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                chat_id: TELEGRAM_CHAT_ID, 
                text: message, 
                parse_mode: 'HTML',
                disable_web_page_preview: true 
            })
        });
    } else {
        // No items, send text only
        await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                chat_id: TELEGRAM_CHAT_ID, 
                text: message, 
                parse_mode: 'HTML',
                disable_web_page_preview: true 
            })
        });
    }
}

    function emojiFor(title) { 
        // simple mapping
        const t = title.toLowerCase(); 
        if (t.includes('waffle') || t.includes('cake') || t.includes('ice cream')) return 'ü•û'; 
        if (t.includes('burger') || t.includes('beef')) return 'üçî'; 
        if (t.includes('coffee') || t.includes('iced')) return 'ü•§'; 
        if (t.includes('fries')) return 'üçü'; 
        return 'üì¶'; 
    }

    function escapeHtml(s) { 
        if (!s) return ''; 
        return String(s).replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('"', '&quot;'); 
    }
    
    function slugify(s) { 
        return String(s || '').toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, ''); 
    }

    // ---------- CHECKOUT FLOW ----------
    document.getElementById('checkoutBtn').addEventListener('click', async () => {
        if (cart.length === 0) { 
            alert('Cart is empty'); 
            return; 
        }
        if (!profile) { 
            alert('Please set your profile first'); 
            openProfileModal(); 
            return; 
        }
        
        // build order
        const id = nextOrderId(); 
        const ph = getPhilippinesNow(); 
        const timestampISO = ph.toISOString(); 
        let total = 0; 
        const items = cart.map(c => { 
            total += c.price * c.qty; 
            return { id: c.id, title: c.title, price: c.price, qty: c.qty, img: c.img }; 
        });
        
        const order = {
            id, 
            profile, 
            items, 
            total, 
            timestampISO,
            status: 'C',      // C = Cooking, D = Delivering, R = Delivered
            payment: 'UNPAID' // UNPAID or PAID
        };

        if (!confirm(`Confirm order?\nTotal: ‚Ç±${total.toFixed(2)}\nOrder ID: ${id}`)) return;
        
        // send
        checkoutBtn.disabled = true; 
        checkoutBtn.textContent = 'Sending...';
        
        try {
            await sendOrderToTelegram(order);
            // save order locally
            orders.unshift(order); 
            localStorage.setItem(LS_ORDERS, JSON.stringify(orders));
            alert('Order sent to Telegram! Order ID: ' + id);
            // clear cart
            cart = []; 
            saveCart(); 
            renderCart();
            // update history UI
            renderHistory();
        } catch (err) {
            console.error('Order send failed', err);
            // fallback: copy text summary to clipboard and instruct manual send
            const { text: fallbackText } = buildOrderTextFallback(order);
            try { 
                await navigator.clipboard.writeText(fallbackText); 
                alert('Could not send via Telegram due to browser restrictions. Order copied to clipboard for manual send.'); 
            } catch (e) { 
                alert('Could not send order and could not copy to clipboard. Check console'); 
            }
        }
        
        checkoutBtn.disabled = false; 
        checkoutBtn.textContent = 'Checkout & Send to Telegram';
    });

    function buildOrderTextFallback(order) { 
    const ph = new Date(order.timestampISO); 
    const time = formatPHDate(ph);
    const name = `${order.profile.last}, ${order.profile.first}${order.profile.middle ? ' ' + order.profile.middle : ''}`;
    
    let text = `üõí Order ID: ${order.id}\n`;
    text += `üõí Order from: ${name}\n`;
    text += `üéì Grade/Section: ${order.profile.grade} - ${order.profile.section}\n`;
    text += `üïí Date/Time: ${time} (GMT+8)\n\n`;
    text += `üì¶ Items:\n`;
    
    let total = 0; 
    order.items.forEach(it => { 
        text += `- ${it.title} x${it.qty} = ‚Ç±${(it.price * it.qty).toFixed(2)}\n`; 
        total += it.price * it.qty; 
    }); 
    
    text += `\nüí∞ Total: ‚Ç±${total.toFixed(2)}\n\n`;
    text += `üîó Visit Shop: ${SHOP_BASE}`;
    
    return { text, total }; 
}

    // ---------- ORDER HISTORY UI ----------
    function renderHistory() {
    const list = document.getElementById('historyList');
    list.innerHTML = '';
    if (orders.length === 0) {
        list.innerHTML = '<div class="small">No orders yet</div>';
        return;
    }

    orders.forEach(o => {
        const el = document.createElement('div');
        el.className = 'history-item';
        const time = formatPHDate(new Date(o.timestampISO));

        // If order is cancelled, show reason
        let reasonText = '';
        if (o.status === 'CANCEL') {
            reasonText = `<div class="small" style="color:#ff6b6b">Reason: ${o.cancelReason || 'No reason provided'}</div>`;
        }

        el.innerHTML = `
            <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-weight:800">${o.id}</div>
                <div class="small">‚Ç±${o.total.toFixed(2)} ‚Ä¢ ${time}</div>
            </div>
            <div class="small">${o.profile.last}, ${o.profile.first} ‚Ä¢ ${o.profile.grade} - ${o.profile.section}</div>
            <div class="small">Status: ${statusText(o.status)} | Payment: ${o.payment}</div>
            ${reasonText}
            <details style="margin-top:8px">
                <summary class="small">View items</summary>
                <div style="margin-top:8px">
                    ${o.items.map(it => `<div class="small">- ${it.title} x${it.qty} = ‚Ç±${it.price.toFixed(2)}</div>`).join('')}
                </div>
            </details>
            ${o.status !== 'CANCEL' ? `<button onclick="cancelOrder('${o.id}')">Cancel Order</button>` : ''}
        `;
        list.appendChild(el);
    });
}

    function exportHistory() { 
        if (orders.length === 0) { 
            alert('No orders to export'); 
            return; 
        } 
        
        const ph = getPhilippinesNow(); 
        const dateStr = `${ph.getFullYear()}${String(ph.getMonth() + 1).padStart(2, '0')}${String(ph.getDate()).padStart(2, '0')}`; 
        const filename = `orders-${dateStr}.txt`; 
        let txt = ''; 
        
        orders.forEach(o => { 
            const time = formatPHDate(new Date(o.timestampISO)); 
            txt += `Order ID: ${o.id}\nName: ${o.profile.last}, ${o.profile.first} ${o.profile.middle || ''}\nGrade/Section: ${o.profile.grade} - ${o.profile.section}\nDate/Time: ${time} (GMT+8)\nItems:\n`; 
            o.items.forEach(it => { 
                txt += ` - ${it.title} x${it.qty} = ‚Ç±${(it.price * it.qty).toFixed(2)}\n`; 
            }); 
            txt += `Total: ‚Ç±${o.total.toFixed(2)}\n----------------------------------------\n\n`; 
        }); 
        
        const blob = new Blob([txt], { type: 'text/plain' }); 
        const url = URL.createObjectURL(blob); 
        const a = document.createElement('a'); 
        a.href = url; 
        a.download = filename; 
        document.body.appendChild(a); 
        a.click(); 
        a.remove(); 
        URL.revokeObjectURL(url); 
    }

    // ---------- MEMBERSHIP FUNCTIONS ----------
    // Function to render team members
    function renderTeamMembers() {
        const memberList = document.getElementById('memberList');
        memberList.innerHTML = '';
        
        TEAM_MEMBERS.forEach(member => {
            const memberCard = document.createElement('div');
            memberCard.className = 'member-card';
            
            memberCard.innerHTML = `
                <div class="member-photo" style="background-image: url('${member.photo}')"></div>
                <div class="member-name">${member.name}</div>
                <div class="member-position">${member.position}</div>
                <div class="member-bio">${member.bio}</div>
                <a href="${member.facebook}" target="_blank" class="social-btn">
                    üìò Facebook
                </a>
            `;
            
            memberList.appendChild(memberCard);
        });
    }

    // Modal functions
    function openMembersModal() {
        membersModal.style.display = 'grid';
        renderTeamMembers();
    }

    function closeMembersModal() {
        membersModal.style.display = 'none';
    }

    // ---------- HELPERS ----------
    // Generate a unique order ID per user
function nextOrderId() {
    // Load the last sequence number from localStorage
    let seqData = JSON.parse(localStorage.getItem(LS_ORDER_SEQ) || '{}');
    
    // Use user identifier: grade-section-lastname-firstname
    const userKey = profile.grade + profile.section + profile.last + profile.first;
    
    // Initialize if not exists
    if (!seqData[userKey]) seqData[userKey] = 0;
    
    // Increment sequence for this user
    seqData[userKey]++;
    
    // Save updated sequence
    localStorage.setItem(LS_ORDER_SEQ, JSON.stringify(seqData));
    
    // Format order ID: ORD-<user initials>-<sequence>-<timestamp>
    const initials = profile.last.charAt(0).toUpperCase() + profile.first.charAt(0).toUpperCase();
    const timestamp = Date.now(); // milliseconds since epoch
    const orderId = `ORD-${initials}-${seqData[userKey]}-${timestamp}`;
    
    return orderId;
}

    function getPhilippinesNow() { 
        const now = new Date(); 
        const utc = now.getTime() + (now.getTimezoneOffset() * 60000); 
        const ph = new Date(utc + (3600000 * 8)); 
        return ph; 
    }
    
    function formatPHDate(d) { 
        const yyyy = d.getFullYear(); 
        const mm = String(d.getMonth() + 1).padStart(2, '0'); 
        const dd = String(d.getDate()).padStart(2, '0'); 
        const hh = String(d.getHours()).padStart(2, '0'); 
        const min = String(d.getMinutes()).padStart(2, '0'); 
        return `${yyyy}-${mm}-${dd} ${hh}:${min}`; 
    }

    // ---------- EVENT LISTENERS ----------
    document.getElementById('openProfileBtn').addEventListener('click', () => openProfileModal());
    document.getElementById('saveProfileBtn').addEventListener('click', () => saveProfile());
    document.getElementById('closeProfileBtn').addEventListener('click', () => closeProfileModal());

    document.getElementById('openHistoryBtn').addEventListener('click', () => { 
        historyModal.style.display = 'grid'; 
        renderHistory(); 
    });
    
    document.getElementById('closeHistoryBtn').addEventListener('click', () => { 
        historyModal.style.display = 'none'; 
    });
    
    document.getElementById('clearHistoryBtn').addEventListener('click', () => { 
        if (!confirm('Are you sure? This will delete all saved orders.')) return; 
        orders = []; 
        localStorage.removeItem(LS_ORDERS); 
        renderHistory(); 
        alert('Order history cleared'); 
    });
    
    document.getElementById('exportBtn').addEventListener('click', () => { 
        exportHistory(); 
    });

    document.getElementById('clearCartBtn').addEventListener('click', () => { 
        if (!confirm('Clear cart?')) return; 
        cart = []; 
        saveCart(); 
        renderCart(); 
    });

    // Event listeners for membership modal
    document.getElementById('openMembersBtn').addEventListener('click', openMembersModal);
    document.getElementById('closeMembersBtn').addEventListener('click', closeMembersModal);

    // Close modal when clicking outside
    membersModal.addEventListener('click', (e) => {
        if (e.target === membersModal) {
            closeMembersModal();
        }
    });

    // search & filters
    searchInput.addEventListener('input', (e) => { 
        renderProducts(); 
    });
    
    foodFilter.addEventListener('change', () => 
        renderProducts()
    );

    // Make functions globally available for onclick handlers
    window.addToCart = addToCart;
    window.cancelOrder = cancelOrder;

    // initialization
    renderChips(); 
    renderProducts(); 
    renderCart(); 
    updateProfileDisplay(); 
    renderHistory();
    
    if (!profile) setTimeout(() => openProfileModal(), 500);

    // expose debug
    window._market = { PRODUCTS, cart, profile, orders };
  </script>
</body>
</html>
